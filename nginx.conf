server {
    listen 80;
    server_name your-domain.com;
    root /path/to/your/dist;
    index index.html;

    # Для главной
    location = / {
        try_files $uri $uri/ /index.html;
    }

    # Для страниц первого уровня (blog, cart, catalog, contacts, returns)
    location ~ ^/(blog|cart|catalog|contacts|returns)(/)?$ {
        try_files $uri $uri/ /$1/index.html;
    }

    # Для вложенных страниц (например, /cart/checkout)
    location ~ ^/(cart|catalog|blog)/([a-zA-Z0-9-]+)(/)?$ {
        try_files $uri $uri/ /$1/$2/index.html;
    }

    # Для вложенных страниц второго уровня (например, /cart/checkout-thanks)
    location ~ ^/(cart|catalog|blog)/([a-zA-Z0-9-]+)/([a-zA-Z0-9-]+)(/)?$ {
        try_files $uri $uri/ /$1/$2/$3/index.html;
    }

    # Для динамических роутов товаров: /catalog/product/{slug}
    location ~ ^/catalog/product/[^/]+/?$ {
        try_files $uri /catalog/product/index.html;
    }

    # Для динамических роутов постов: /blog/post/{slug}
    location ~ ^/blog/post/[^/]+/?$ {
        try_files $uri /blog/post/index.html;
    }

    # Кеширование статики
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|webp|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # Отключаем кеш для HTML
    location ~* \.html$ {
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }

    # 404 для несуществующих ассетов
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|json)$ {
        try_files $uri =404;
    }

    # Универсальный fallback для SPA (отдаёт index.html на все неразрешённые пути)
    location / {
        try_files $uri $uri/ /index.html;
    }
}